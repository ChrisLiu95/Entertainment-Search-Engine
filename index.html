<!DOCTYPE html>
<html>
	<head>	
		<title> My Search Engine</title>	
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
		<link rel="stylesheet" href="style.css">
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.0/jquery.min.js"></script>
		<script src="http://cdn.static.runoob.com/libs/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<!-- 	    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.0.0/js/bootstrap.min.js"></script> -->
	    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.3/angular.min.js"></script>
	    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.4/angular-animate.js"></script>
<!-- 	    <link rel="stylesheet" href="/Users/Lxc/Desktop/myHW8/node_modules/rateyo/min/jquery.rateyo.min.css"/> -->
	    <script src="moment.js"></script>
<!-- 		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">  --> 
	    <script src="script.js"></script>
				
		<script>
			moment().format();			
			function isNull(str){
				if ( str == "" ) return true;
				var regu = "^[ ]+$";
				var re = new RegExp(regu);
				return re.test(str);
			}
			
			function keyvalidation2(){
				if (isNull(document.getElementById("keyword").value) == true){
					document.getElementById("warningA").style.display="";
				}else{
					document.getElementById("warningA").style.display="none";
				}
			}
			
			var placeSearch, autocomplete, autocomplete2;
	
			function initAutocomplete() {
	        // Create the autocomplete object, restricting the search to geographical
	        // location types.
	        autocomplete = new google.maps.places.Autocomplete(
	            /** @type {!HTMLInputElement} */
	            (document.getElementById('inputLocation')),
	            {types: ['geocode']});
				
			autocomplete2 = new google.maps.places.Autocomplete(
	            /** @type {!HTMLInputElement} */
	            (document.getElementById('mapstarter')),
	            {types: ['geocode']});
	        // When the user selects an address from the dropdown, populate the address
	        // fields in the form.
	        autocomplete.addListener('place_changed', fillInAddress);
	        autocomplete2.addListener('place_changed', fillInAddress);
	      }
	
		    function fillInAddress() {
	        // Get the place details from the autocomplete object.
	        var place = autocomplete.getPlace();
	
	        // Get each component of the address from the place details
	        // and fill the corresponding field on the form.
	      }
	
	      // Bias the autocomplete object to the user's geographical location,
	      // as supplied by the browser's 'navigator.geolocation' object.
	      function geolocate() {
	        if (navigator.geolocation) {
	          navigator.geolocation.getCurrentPosition(function(position) {
	            var geolocation = {
	              lat: position.coords.latitude,
	              lng: position.coords.longitude
	            };
	            var circle = new google.maps.Circle({
	              center: geolocation,
	              radius: position.coords.accuracy
	            });
	            autocomplete.setBounds(circle.getBounds());
	            autocomplete2.setBounds(circle.getBounds());
	          });
	       	}
	    }
	    	    
	    </script>
	    
	    
	    
	    <style type="text/css" media="screen">
	    .table tbody tr td{
            vertical-align: middle;
        }
        #mymap {
			height:300px;	
        }
        .streetview{
			height:300px;		
       	}

       	.mystyle{
	       	top: 20px;
	       	padding-top: 20px;
	   		margin-top: 20px;
	   		margin-left: 0px;
	   		border-radius: 5px;
	   		border:1px solid grey;
       	}
       	.starcolor{
	       	color: #fdd444;	
       	}
       	
		.fadein.ng-hide-remove {
		    -webkit-transition : 1s ease-in-out opacity;
		    -moz-transition    : 1s ease-in-out opacity;
		    -ms-transition     : 1s ease-in-out opacity;
		    -o-transition      : 1s ease-in-out opacity;
		    transition         : 1s ease-in-out opacity;
		    opacity            : 1;
		}
		
		.fadein.ng-hide {
		    opacity : 0;
		}
		
		.slidingDetail {
		  -webkit-transition: 0.3s linear all;
		  overflow: hidden;
		}
		.slidingDetail.ng-hide {
		  -webkit-transform: translateX(100%);
		}
		.slidingDetail.ng-hide-add {
		  -webkit-transition: 0s linear all;
		}
		
		.slidingTables{
		  -webkit-transition: 0.3s linear all;
		  overflow: hidden;
		}
		.slidingTables.ng-hide {
		  -webkit-transform: translateX(100%);
		}
		.slidingTables.ng-hide-add {
		  -webkit-transition: 0s linear all;
		}
		
		.rowPhoto {
		    display: -ms-flexbox; /* IE10 */
		    display: flex;
		    -ms-flex-wrap: wrap; /* IE10 */
		    flex-wrap: wrap;
		    padding: 0 4px;
		}
		
		/* Create four equal columnPhotos that sits next to each other */
		.columnPhoto {
		    -ms-flex: 25%; /* IE10 */
		    flex: 25%;
		    max-width: 25%;
		    padding: 0 4px;
		}
		
		.columnPhoto img {
		    margin-top: 8px;
		    vertical-align: middle;
		}
		
		.img-thumbnail{
			width:100%;
		}
		
		.dark{
			color:white;
			background-color: #77818b;
		}
		.table{
	
		}
		.table td{
		    white-space:nowrap;/* 不换行 */
		}
/* Responsive layout - makes the two columnPhotos stack on top of each other instead of next to each other */
@media screen and (max-width: 768px) {
		    .columnPhoto {
		        -ms-flex: 100%;
		        flex: 100%;
		        max-width: 100%;
		    }
		}
	    </style>
	</head>
	<body>
		<div class="container" ng-app="myApp" ng-controller="myCtrl">
			<br>
			<div class="panel panel-default">
				<div class="panel-heading">
					<form class="needs-validation" name="myForm" ng-submit="GoogleSearch()">
						<div class="form-group">
							<h2 class = "text-center"> Travel and Entertainment Search </h2>
			            </div>
			            <br>
			            <div class="form-group row">
			                <label for="keyword" class="col-sm-2 col-form-label">Keyword
			                	<span class="text-danger">*</span>
			                </label>
			                <div class="col-sm-6">
			                	<input type="text" class="form-control" ng-model="keyword" name="keyword" ng-change="enableSearch()" required>
		                	    <div class="text-danger" ng-show="myForm.keyword.$touched && myForm.keyword.$invalid">
						        	Please enter a keyword.
						      	</div>
			                </div>
			            </div>
			            <div class="form-group row">
		                	<label for="category" class="col-sm-2 col-form-label">Category</label>
		                	<div class="col-sm-4">
				                <select class="form-control" ng-init="selectedCategory = categories[0]" ng-model="selectedCategory" ng-options="x for x in categories">
				                </select>
			                </div>
		                </div>
			            <div class="form-group row">
			                <label for="distance" class="col-sm-2 col-form-label">Distance (miles)</label>
			                <div class="col-sm-4">
			                	<input type="text" class="form-control" placeholder="10" ng-model="distance" ng-change="enableSearch()">
			                </div>
			            </div>
						<fieldset class="form-group">
						    <div class="row">
							    <label class="col-form-label col-sm-2">From
							    	<span class="text-danger">*</span>
							    </label>
							    <div class="col-sm-10">
							        <div class="form-check">
							          <input class="form-check-input" type="radio" ng-model="selectedLocation" ng-change="disable()" id="gridRadios1" value="here" ng-checked="true">
							          <label class="form-check-label" for="gridRadios1">
							            Current Location
							          </label>
							        </div>
							        <div class="form-check">
							          <input class="form-check-input" type="radio" ng-model="selectedLocation" id="gridRadios2" value="other" ng-change="enable()">
							          <label class="form-check-label" for="gridRadios2">
							            Other. Please specify:
							          </label>
							        </div>
									<input class="col-sm-8" type="text" ng-model="inputLocation" id="inputLocation" placeholder="Enter a location" ng-disabled ="myloc"  ng-change="enableSearch()"><br>
									<div class="col-sm-8 text-danger" ng-show = "false" id="warningB">
						        		Please enter a location.
						      		</div>
						      	</div>
						    </div>
						    <br>
							<button type="submit" class="btn btn-primary" ng-disabled="searchbutton"><span class="glyphicon glyphicon-search"></span> Search</button>
			            	<button type="button" class="btn btn-default" ng-click = "clear()">Clear</button>
						</fieldset>
		            </form>
		        </div>
            </div>

			<div class="container" ng-show="myNav">
				<ul class="pager">
					<li><input type="button" class="btn btn-primary" ng-click="displayResult()" id="results" value="Results"/></li>
					<li><input type="button" class="btn btn-default" ng-click="displayFavo()" id="favorite" value="Favorites"/></li>
				</ul>
			</div>
			
			<div>
				<button type="button" ng-disabled="recentbutton" ng-show="resultbutton" class="btn btn-default pull-right" ng-click="mostrecent(lastplace)">Details</button>
			</div>
			<br>
			<br>
			
			<!-- result table -->
			<div class="slidingTables" ng-show="resulttable">
				<br>
				<div class="table-responsive">
					<table class='table table-striped table-hover'>
						<tbody>
						<tr>
							<th width='60px'> # </th>
							<th width='80px'> Category </th>
							<th width='300px'> Name </th>
							<th width='500px'> address </th>
							<th width='60px'> Favorite </th>
							<th width='60px'> Details </th>
						</tr>
						<tr ng-repeat="x in nearby" class="{{x.linestyle}}">
							<td>{{$index+1}}</td>
							<td><image src={{x.icon}} height='40' width='60'></td>
							<td>{{x.name}}</td>
							<td>{{x.vicinity}}</td>
							<td><button type='button' class='btn btn-default' aria-label='Left Align' ng-click='favorite(x)'><span class='{{x.btnstyle}}'></span></button></td>
							<td><button type='button' class='btn btn-default' aria-label='Left Align' ng-click='details([x.place_id,x.geometry.location.lat,x.geometry.location.lng, x])'><span class='glyphicon glyphicon-menu-right'></span></button></td>
		<!-- 					<td ng-show='false'>{{x.place_id}}</td> -->
						</tr>
						</tbody>	
					</table>
				</div>
			</div>
			
			<!-- favorite table -->
			<div class="slidingTables" ng-show="favoritetable">
				<br>
				<div class="table-responsive ">
					<table class='table table-striped table-hover'>
						<tbody>
							<tr>
								<th width='60px'> # </th>
								<th width='80px'> Category </th>
								<th width='300px'> Name </th>
								<th width='500px'> address </th>
								<th width='60px'> Favorite </th>
								<th width='60px'> Details </th>
							</tr>
							<tr ng-repeat="x in favoriteDatas" class="{{x[3][3].linestyle}}">
								<td>{{$index+1}}</td>
								<td><image src={{x[0]}} height='40' width='60'></td>
								<td>{{x[1]}}</td>
								<td>{{x[2]}}</td>
								<td><button type='button' class='btn btn-default' aria-label='Left Align' ng-click='deleteFavorite(x[3][3])'><span class="glyphicon glyphicon-trash"></span></button></td>
								<td><button type='button' class='btn btn-default' aria-label='Left Align' ng-click='details(x[3])'><span class='glyphicon glyphicon-menu-right'></span></button></td>
							</tr>
						</tbody>	
					</table>
				</div>
			</div>			
			
			<!-- progress bar-->
			<div class="progress" ng-show="progressbar">
			    <div class="progress-bar" role="progressbar" aria-valuenow="60" 
			        aria-valuemin="0" aria-valuemax="100" style="width: 50%;">
			    </div>
			</div>				
			
			<!-- details page NAV-->
			<div class="container slidingDetail" ng-show='showdetails'>
				<div><h2 ng-model="placedetail" style="text-align: center "> {{placedetail.name}}</h2></div>
				<button type="button" class="btn btn-default" ng-click="mainPage()"><span class="glyphicon glyphicon-menu-left"></span>List</button>
				<a href="{{twitter}}"><img src="http://cs-server.usc.edu:45678/hw/hw8/images/Twitter.png" class='pull-right' width="36px" height="34px"></img></a>
				<span class='pull-right'>&nbsp;&nbsp;&nbsp;</span>
				<button type='button' class='btn btn-default pull-right' aria-label='Left Align' ng-click='favorite(total)'><span class={{total.btnstyle}}></span></button><br>
				<ul class="nav nav-tabs pull-right">
				  <li class="nav-item">
				    <a class="nav-link active" ng-click="showInfo()">Info</a>
				  </li>
				  <li class="nav-item">
				    <a class="nav-link" ng-click="showPhotos()">Photos</a>
				  </li>
				  <li class="nav-item">
				    <a class="nav-link" ng-click="showMaps(placedetail)">Map</a>
				  </li>
				  <li class="nav-item">
				    <a class="nav-link" ng-click="showReviews()">Reviews</a>
				  </li>
				</ul>
			</div>
			
			<!-- Info -->
			<div class="container slidingDetail" ng-show='showinfo'>
				<div class="table-responsive">
					<table class='table table-striped'>
						<tbody>
							<tr ng-show="tr1">
								<td class="col-sm-2">
									<strong>Address</strong></td><td ng-model="placedetail" class="col-sm-8"> {{placedetail.formatted_address}}	
								</td>
							</tr>
							<tr ng-show="tr2">
								<td>
									<strong>Phone number</strong></td><td ng-model="placedetail">	{{placedetail.international_phone_number}}
								</td>
							</tr>
							<tr ng-show="tr3">
								<td><strong>Price Level</strong></td><td ng-model="placedetail"> {{placedetail.price_level}}	
								</td>
							</tr>
							<tr ng-show="tr4">
								<td><strong>Rating</strong></td><td ng-model="placedetail"> {{placedetail.rating}}<!-- <span id="rateYo" ng-model="rating"></span> -->
								</td>
							</tr>
							<tr ng-show="tr5">
								<td>
									<strong>GooglePage</strong></td><td ng-model="placedetail"><a href="{{placedetail.url}}" target="_Blank"> {{placedetail.url}}</a>
								</td>
							</tr>
							<tr ng-show="tr6">
								<td><strong>Website</strong></td><td ng-model="placedetail"><a href="{{placedetail.website}}" target="_Blank"> {{placedetail.website}}</a>
								</td>
							</tr>
							<tr ng-show="tr7">
								<td><strong>Hours</strong></td><td ng-model="placedetail"> 
									<span>{{info_open}}&nbsp;&nbsp;<a data-toggle="modal" href="#myModal">Daily open hours</a></span>	
								</td>
							</tr>
						</tbody>
					</table>
				</div>
			</div>
			
			<!-- Modal -->
			<div id="myModal" class="modal fade" role="dialog">
			  <div class="modal-dialog">			
			    <!-- Modal content-->
			    <div class="modal-content">
			      <div class="modal-header">
			        <button type="button" class="close" data-dismiss="modal">&times;</button>
			        <h4 class="modal-title">Open hours</h4>
			      </div>
			      <div class="modal-body">
			        <table class="table">
				        <tbody>
						    <tr>
								<th scope='row'>{{today}}</th>
								<th scope='row'>{{todayTime}}</th>
							</tr>
							<tr ng-repeat="day in days">	
						        <td>{{day.name}}</td>
					            <td>{{day.time}}</td>
					        </tr>
					    </tbody>
			        </table>
			      </div>
			      <div class="modal-footer">
			        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
			      </div>
			    </div>			
			  </div>
			</div>
			
			<!-- show photo-->
			<div class="container-fluid" ng-show="showphoto">
				<div class="rowPhoto"> 
				  	<div class="columnPhoto" ng-repeat="x in photosUrl">
				    	<img class="img-thumbnail" src="{{y.getUrl({'maxWidth': 9999,'maxHeight': 9999})}}" ng-click = "highresolution(y)" ng-repeat="y in x">
					</div>
				</div>
			</div>
			
			<!-- show fucking map nav-->
			<div class="container" ng-show="wholemap">
				<div class="container" ng-show="showmap">
					<br>
					<form>
					  	<div class="form-row">
						    <div class="col-md-3">
						      <label for="from">From</label>
						      <input type="text" class="form-control" ng-model="mapstart" id="mapstarter" required>
						    </div>
						    <div class="col-md-5">
						      <label for="to">To</label> 
						      <input type="text" class="form-control" ng-model="placedetail.formatted_address" id="end"  disabled="true"> 
						    </div>
						    <div class="col-md-4">
						      <label for="travelmode">Travel Mode</label>
						      	<div class="form-inline">
							        <select class="form-control" ng-init="travelmode=travelmodes[0]" ng-model="travelmode" ng-options="x for x in travelmodes">
								    </select><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
								    <button type="button" class="btn btn-primary" ng-click="getmap(placedetail)">Get Directions</button>
							    </div>
						    </div>				    
					  	</div>
					</form>
				</div>					
				
				<!-- pegman -->
				<div class="container">
					<br>
					<button type="button" class="btn btn-default" ng-click="toggle(placedetail)"><img src="{{sign}}" width="28px" height="28px" ></button>
				</div>
				<br>
				<!-- streetview -->
				<div class="container streetview" id="streetview" ng-show="showstreetview" >			
				</div>	
				
				<!-- mymap -->
				<div class="container" id="mymap" ng-show="mymap">
				</div>		
				
				<!-- showRoute -->
				<div class="container" id="route" ng-show="route">
				</div>
			</div>
			
			<!-- reviews -->
			<div class="container" id="myreview">
				<br>
				<div class="form-inline" ng-show="showreview">
					<select class="form-control dark" ng-init="reviewtype=reviewtypes[0]" ng-model="reviewtype" ng-options="x for x in reviewtypes" ng-change="reviewchange()"></select>
					<select class="form-control dark" ng-init="order=revieworders[0]" ng-model="order" ng-options="x for x in revieworders" ng-change="orderchange()"></select>
				</div>
				<br><br>
				
				<!--google reviews -->
				<div class="row mystyle fadein" ng-repeat="x in google" ng-show="defaultreview">
					<div class="col-md-1">
						<a href="{{x.author_url}}" target="_blank"><img src="{{x.profile_photo_url}}" width="50px" height="50px"></a>
					</div>
					<div class="col-md-11">
						<a href="{{x.author_url}}" target="_blank">{{x.author_name}}</a><br>
						<p>{{x.stars}}</span>&nbsp;&nbsp;&nbsp;{{x.time}}</p>
						<p>{{x.text}}</p>
					</div>
				</div>
				
				<!-- show yelp reviews -->
				<div class="row mystyle fadein" ng-repeat="x in yelp" ng-show="yelpreview" id="yelpreview">
					<div class="col-md-1">
						<a href="{{x.url}}" target="_blank"><img src="{{x.user.image_url}}" width="50px" height="50px"></a>
					</div>
					<div class="col-md-11">
						<a href="{{x.url}}" target="_blank">{{x.user.name}}</a><br>
						<p>{{x.stars}}&nbsp;&nbsp;&nbsp;{{x.time_created}}</span></p>
						<p>{{x.text}}</p>
					</div>
				</div>				
			</div>
						
<!-- 			<div style="height: 300px"></div> -->
			<!-- autocomplete-->			
			<div id="map" ></div>
			
			<!-- no result -->
			<div class="alert alert-warning" role="alert" ng-show = "noresult">
				No results!
			</div>
			
			<!-- no photo -->
			<div class="alert alert-warning" role="alert" ng-show = "nophoto">
				No photos!
			</div>
			
			<!-- no google review -->
			<div class="alert alert-warning" role="alert" ng-show = "noreview">
				No reviews!
			</div>
			
			<!-- no Favo -->
			<div class="alert alert-warning" role="alert" ng-show = "noFavo">
				No Favorite Datas!
			</div>
			
			<!--  next and previous button-->
			<div class="container" ng-show="preNext"> 
				<ul class="pager">
					<li><button type="button" class="btn btn-default" ng-click="prePage()">Previous</button></li>
					<span>&nbsp;&nbsp;</span>
					<li><button type="button" class="btn btn-default" ng-click="nextPage()">next</button></li>
				</ul>		
			</div>	
			
			<div class="container" ng-show="nextbutton"> 
				<ul class="pager">
					<li><button type="button" class="btn btn-default" ng-click="nextPage(nextPagetoken)">next</button></li>
				</ul>		
			</div>
			
			<div class="container" ng-show="prevbutton"> 
				<ul class="pager">
					<li><button type="button" class="btn btn-default" ng-click="prePage()">Previous</button></li>
				</ul>		
			</div>
			
			<div class="container" style="height: 100px">
			</div>
				
		</div>
		<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDrej8ZAvvF4lN8hz7grQxgos_BWRc_IrE&libraries=places,geometry&callback=initAutocomplete"
	        async defer>
	    </script>	    
	    <script type="text/javascript" async src="https://platform.twitter.com/widgets.js"></script>
<!-- 		<script src="jquery.rateyo.min.js"></script> -->
	</body>
</html>